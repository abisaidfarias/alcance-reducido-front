<div class="modal-wrapper">
  <div class="modal-header">
    <h2 mat-dialog-title>
      {{ isEditMode ? 'Editar Usuario' : 'Nuevo Usuario' }}
    </h2>
  </div>

  <mat-dialog-content class="modal-body">
    <form [formGroup]="usuarioForm" class="usuario-form">
      <mat-form-field appearance="outline" class="form-field-full" [floatLabel]="'always'">
        <mat-label>Nombre</mat-label>
        <input matInput formControlName="nombre" placeholder="Ej: Juan Pérez">
        <mat-icon matPrefix>person</mat-icon>
        <mat-error *ngIf="usuarioForm.get('nombre')?.hasError('required')">
          El nombre es requerido
        </mat-error>
        <mat-error *ngIf="usuarioForm.get('nombre')?.hasError('minlength')">
          El nombre debe tener al menos 2 caracteres
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-full" [floatLabel]="'always'">
        <mat-label>Email</mat-label>
        <input matInput type="email" formControlName="email" placeholder="Ej: usuario@example.com">
        <mat-icon matPrefix>email</mat-icon>
        <mat-error *ngIf="usuarioForm.get('email')?.hasError('required')">
          El email es requerido
        </mat-error>
        <mat-error *ngIf="usuarioForm.get('email')?.hasError('email')">
          Ingresa un email válido
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-full" [floatLabel]="'always'">
        <mat-label>Contraseña</mat-label>
        <input 
          matInput 
          [type]="hidePassword ? 'password' : 'text'" 
          formControlName="password" 
          [placeholder]="isEditMode ? 'Dejar vacío para no cambiar' : 'Mínimo 6 caracteres'">
        <mat-icon matPrefix>lock</mat-icon>
        <button 
          mat-icon-button 
          matSuffix 
          (click)="hidePassword = !hidePassword" 
          type="button"
          [attr.aria-label]="'Ocultar contraseña'"
          [attr.aria-pressed]="hidePassword">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-hint *ngIf="isEditMode">Dejar vacío para mantener la contraseña actual</mat-hint>
        <mat-error *ngIf="usuarioForm.get('password')?.hasError('required')">
          La contraseña es requerida
        </mat-error>
        <mat-error *ngIf="usuarioForm.get('password')?.hasError('minlength')">
          La contraseña debe tener al menos 6 caracteres
        </mat-error>
      </mat-form-field>

      <mat-form-field 
        *ngIf="!isEditMode || usuarioForm.get('password')?.value" 
        appearance="outline" 
        class="form-field-full" 
        [floatLabel]="'always'">
        <mat-label>Confirmar Contraseña</mat-label>
        <input 
          matInput 
          [type]="hideConfirmPassword ? 'password' : 'text'" 
          formControlName="confirmPassword" 
          placeholder="Confirma la contraseña">
        <mat-icon matPrefix>lock_outline</mat-icon>
        <button 
          mat-icon-button 
          matSuffix 
          (click)="hideConfirmPassword = !hideConfirmPassword" 
          type="button"
          [attr.aria-label]="'Ocultar confirmación de contraseña'"
          [attr.aria-pressed]="hideConfirmPassword">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="usuarioForm.get('confirmPassword')?.hasError('required')">
          La confirmación de contraseña es requerida
        </mat-error>
        <mat-error *ngIf="usuarioForm.get('confirmPassword')?.hasError('passwordMismatch')">
          Las contraseñas no coinciden
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="form-field-full" [floatLabel]="'always'">
        <mat-label>Rol</mat-label>
        <mat-select formControlName="rol">
          <mat-option value="admin">Administrador</mat-option>
        </mat-select>
        <mat-icon matPrefix>admin_panel_settings</mat-icon>
        <mat-error *ngIf="usuarioForm.get('rol')?.hasError('required')">
          El rol es requerido
        </mat-error>
      </mat-form-field>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions class="modal-footer" align="end">
    <button mat-button (click)="onCancel()">Cancelar</button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="!usuarioForm.valid">
      {{ isEditMode ? 'Actualizar' : 'Crear' }}
    </button>
  </mat-dialog-actions>
</div>

