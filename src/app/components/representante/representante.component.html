<div class="representante-container">
  <!-- NAV -->
  <div class="nav">
    <div class="container">
      <div class="nav-inner">
        <a class="brand-row" (click)="goToHome()" style="cursor: pointer;" aria-label="Ir al Home">
          <div class="brand-logo-wrapper">
            <img class="brand-logo-img" src="assets/lb-technology-logo.png" alt="LB Technology" />
          </div>
        </a>

        <nav class="nav-links" aria-label="Navegaci√≥n">
          <a (click)="goToHome()" style="cursor: pointer;">Home</a>
          <a (click)="goToHome()" style="cursor: pointer;">Normativa</a>
          <a (click)="goToHome()" style="cursor: pointer;">Servicios</a>
          <a (click)="goToHome()" style="cursor: pointer;">Contacto</a>
        </nav>

        <div class="nav-cta">
          <a class="btn ghost" (click)="goToHome()" style="cursor: pointer;">Contacto</a>
          <a class="btn primary" (click)="goToHome()" style="cursor: pointer;">Solicitar asesor√≠a</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando informaci√≥n...</p>
  </div>

  <!-- Vista de Marcas (solo si tiene datos) -->
  <div class="marcas-section" *ngIf="!loading && !mostrarDispositivos && tieneDatos">
    <!-- PAGE HEADER -->
    <header class="page">
      <div class="container">
        <span class="pill">
          <span class="dot"></span>
          P√°gina del distribuidor / importador
        </span>

        <div class="breadcrumbs" aria-label="Breadcrumbs">
          <a class="crumb" (click)="goToHome()" style="cursor: pointer;" title="Ir al Home">
            <mat-icon style="font-size: 16px; width: 16px; height: 16px; line-height: 16px; vertical-align: middle;">home</mat-icon>
          </a>
          <span style="opacity:.6;">/</span>
          <span class="crumb" aria-current="page">{{ getNombreRepresentante() }}</span>
        </div>

        <div class="title-row">
          <div>
            <h1 class="h1">{{ getNombreRepresentante() }}</h1>
            <p class="sub">
              Selecciona una marca para ver los equipos disponibles. Esta p√°gina corresponde al importador/distribuidor asociado al QR del empaque.
            </p>
          </div>

          <div class="filters">
            <div class="input" role="search">
              <span aria-hidden="true" style="opacity:.8;">üîé</span>
              <input 
                id="brandSearch" 
                type="search" 
                placeholder="Buscar marca (ej: Xiaomi, Samsung, Nothing‚Ä¶)" 
                [(ngModel)]="searchQuery"
                (input)="filterMarcas()" />
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- BRANDS -->
    <section>
      <div class="container">
        <div class="grid" id="brandGrid" *ngIf="marcasFiltradas.length > 0">
          <a 
            class="brand-card" 
            *ngFor="let marca of marcasFiltradas"
            (click)="onMarcaClick(marca)"
            style="cursor: pointer;"
            [attr.data-name]="marca.marca?.toLowerCase()">
            <div>
              <p class="brand-name">{{ marca.marca || marca.fabricante }}</p>
              <p class="brand-hint">Ver modelos disponibles</p>
            </div>
            <div class="brand-cta">
              <span class="arrow">‚Üí</span>
            </div>
          </a>
        </div>

        <div class="no-data" *ngIf="marcasFiltradas.length === 0 && marcas.length > 0">
          <p>No se encontraron marcas con ese nombre</p>
        </div>

        <div class="no-data" *ngIf="marcas.length === 0">
          <p>No hay marcas disponibles</p>
        </div>
      </div>
    </section>
  </div>

  <!-- Vista vac√≠a (sin datos pero sin error) -->
  <div class="empty-view" *ngIf="!loading && !tieneDatos && !mostrarDispositivos">
    <!-- Solo muestra el nombre del representante, p√°gina en blanco -->
  </div>

  <!-- FOOTER -->
  <footer *ngIf="!loading && !mostrarDispositivos && !mostrarDetalleDispositivo">
    <div class="container">
      <div class="footer-grid">
        <div>
          <div style="display:flex; gap:10px; align-items:center; margin-bottom: 8px;">
            <div class="footer-logo-wrapper">
              <img class="brand-logo-img footer-logo" src="assets/lb-technology-logo.png" alt="LB Technology" />
            </div>
            <div style="font-weight: 750;">Alcance Reducido ¬∑ Operado por LB Technology</div>
          </div>
          <div>
            ¬© {{ currentYear }} LB Technology. Todos los derechos reservados.
            <div style="margin-top:6px;">
              <span style="color: var(--muted2);">
                Aviso: contenido informativo de alto nivel. La implementaci√≥n final depende del caso y documentaci√≥n del equipo.
              </span>
            </div>
          </div>
        </div>

        <div class="foot-links">
          <a (click)="goToHome()" style="cursor: pointer;">Home</a>
          <a (click)="goToHome()" style="cursor: pointer;">Normativa</a>
          <a (click)="goToHome()" style="cursor: pointer;">Servicios</a>
          <a (click)="goToHome()" style="cursor: pointer;">Contacto</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Vista de Dispositivos -->
  <div class="dispositivos-section" *ngIf="mostrarDispositivos && !mostrarDetalleDispositivo">
    <!-- PAGE HEADER -->
    <header class="page">
      <div class="container">
        <span class="pill">
          <span class="dot"></span>
          Marca habilitada
        </span>

        <div class="breadcrumbs" aria-label="Breadcrumbs">
          <a class="crumb" (click)="volverAtras()" style="cursor: pointer;" title="Volver a marcas">‚Üê {{ getNombreRepresentante() }}</a>
          <span style="opacity:.6;">/</span>
          <span class="crumb" aria-current="page">{{ marcaSeleccionada?.marca || marcaSeleccionada?.fabricante }}</span>
        </div>

        <div class="title-row">
          <div>
            <h1 class="h1">{{ marcaSeleccionada?.marca || marcaSeleccionada?.fabricante }}</h1>
            <p class="sub">
              Selecciona un modelo para acceder a la informaci√≥n comercial y t√©cnica asociada al QR del empaque.
            </p>
          </div>

          <div class="filters">
            <div class="input" role="search">
              <span aria-hidden="true" style="opacity:.8;">üîé</span>
              <input 
                id="modelSearch" 
                type="search" 
                placeholder="Buscar modelo (ej: v10, v11‚Ä¶)" 
                [(ngModel)]="searchQueryDispositivos"
                (input)="filterDispositivos()" />
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- DEVICES -->
    <section>
      <div class="container">
        <div class="grid" id="deviceGrid" *ngIf="dispositivosFiltrados.length > 0">
          <a 
            class="brand-card dispositivo-card-link" 
            *ngFor="let dispositivo of dispositivosFiltrados"
            (click)="onDispositivoClick(dispositivo)"
            style="cursor: pointer;"
            [attr.data-name]="dispositivo.modelo.toLowerCase()">
            <div>
              <p class="brand-name">{{ dispositivo.modelo }}</p>
              <p class="brand-hint">Ver informaci√≥n del dispositivo</p>
            </div>
            <div class="brand-cta">
              <span class="arrow">‚Üí</span>
            </div>
          </a>
        </div>

        <div class="no-data" *ngIf="dispositivosFiltrados.length === 0 && dispositivos.length > 0">
          <p>No se encontraron modelos con ese nombre</p>
        </div>

        <div class="no-data" *ngIf="dispositivos.length === 0">
          <p>No hay dispositivos disponibles para esta marca</p>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <div class="footer-grid">
          <div>
            <div style="display:flex; gap:10px; align-items:center; margin-bottom: 8px;">
              <div class="footer-logo-wrapper">
                <img class="brand-logo-img footer-logo" src="assets/lb-technology-logo.png" alt="LB Technology" />
              </div>
              <div style="font-weight: 750;">Alcance Reducido ¬∑ Operado por LB Technology</div>
            </div>
            <div>
              ¬© {{ currentYear }} LB Technology. Todos los derechos reservados.
              <div style="margin-top:6px;">
                <span style="color: var(--muted2);">
                  Aviso: contenido informativo de alto nivel. La implementaci√≥n final depende del caso y documentaci√≥n del equipo.
                </span>
              </div>
            </div>
          </div>

          <div class="foot-links">
            <a (click)="goToHome()" style="cursor: pointer;">Home</a>
            <a (click)="goToHome()" style="cursor: pointer;">Normativa</a>
            <a (click)="goToHome()" style="cursor: pointer;">Servicios</a>
            <a (click)="goToHome()" style="cursor: pointer;">Contacto</a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Vista de Detalle del Dispositivo -->
  <div class="detalle-dispositivo-section" *ngIf="mostrarDetalleDispositivo && dispositivoSeleccionado">
    <!-- PAGE HEADER -->
    <header class="page">
      <div class="container">
        <span class="pill">
          <span class="dot"></span>
          Ficha del dispositivo
        </span>

        <div class="breadcrumbs" aria-label="Breadcrumbs">
          <a class="crumb" (click)="volverAtras()" style="cursor: pointer;" title="Volver a modelos">‚Üê {{ getNombreRepresentante() }}</a>
          <span style="opacity:.6;">/</span>
          <a class="crumb" (click)="volverADispositivos()" style="cursor: pointer;" title="Volver a dispositivos">{{ marcaSeleccionada?.marca || marcaSeleccionada?.fabricante }}</a>
          <span style="opacity:.6;">/</span>
          <span class="crumb" aria-current="page">{{ dispositivoSeleccionado.modelo }}</span>
        </div>

        <div class="title-row">
          <div>
            <h1 class="h1">{{ marcaSeleccionada?.marca || marcaSeleccionada?.fabricante }} ‚Ä¢ {{ dispositivoSeleccionado.modelo }}</h1>
            <p class="sub">
              Informaci√≥n comercial y t√©cnica disponible para consulta p√∫blica (QR del empaque). Contenido conforme a alcance reducido SUBTEL, seg√∫n documentaci√≥n proporcionada por el importador/distribuidor.
            </p>
          </div>
        </div>
      </div>
    </header>

    <!-- CONTENT -->
    <section class="detalle-section">
      <div class="container">
        <!-- Primera fila: A. INFORMACI√ìN COMERCIAL + IMAGEN (2 columnas) -->
        <div class="top-grid">
          <!-- Columna izquierda: Informaci√≥n Comercial -->
          <div class="detalle-info-column">
            <div class="info-section-card">
              <h2 class="info-section-title">A. INFORMACI√ìN COMERCIAL</h2>
              <p class="info-section-subtitle">Datos de publicaci√≥n y contacto</p>
              
              <div class="info-grid">
                <div class="info-item">
                  <label class="info-label">FECHA DE PUBLICACI√ìN</label>
                  <p class="info-value">{{ getFechaPublicacion() }}</p>
                </div>

                <div class="info-item">
                  <label class="info-label">NOMBRE COMERCIAL DEL EQUIPO</label>
                  <p class="info-value">{{ dispositivoSeleccionado.nombreComercial || dispositivoSeleccionado.modelo || 'No disponible' }}</p>
                </div>

                <div class="info-item">
                  <label class="info-label">FABRICANTE</label>
                  <p class="info-value">{{ marcaSeleccionada?.fabricante || marcaSeleccionada?.marca || 'No disponible' }}</p>
                </div>

                <div class="info-item">
                  <label class="info-label">IMPORTADOR O REPRESENTANTE EN CHILE</label>
                  <p class="info-value">{{ getNombreRepresentante() || 'No disponible' }}</p>
                </div>

                <div class="info-item">
                  <label class="info-label">DOMICILIO</label>
                  <p class="info-value">{{ distribuidor?.domicilio || 'No disponible' }}</p>
                </div>

                <div class="info-item">
                  <label class="info-label">CORREO ELECTR√ìNICO DE CONTACTO</label>
                  <p class="info-value">
                    <a *ngIf="distribuidor?.email" [href]="'mailto:' + distribuidor.email" class="info-link">
                      {{ distribuidor.email }}
                    </a>
                    <span *ngIf="!distribuidor?.email">No disponible</span>
                  </p>
                </div>

                <div class="info-item full-width">
                  <label class="info-label">SITIO WEB</label>
                  <p class="info-value">
                    <a *ngIf="distribuidor?.sitioWeb" [href]="getWebsiteUrl(distribuidor.sitioWeb)" target="_blank" class="info-link">
                      {{ distribuidor.sitioWeb }}
                    </a>
                    <span *ngIf="!distribuidor?.sitioWeb">No disponible</span>
                  </p>
                </div>

              </div>

              <div class="info-notice" *ngIf="distribuidor">
                <p><strong>Importante sobre el representante:</strong> Seg√∫n confirmaci√≥n oficial de OIRS-SUBTEL, el importador o representante debe tener domicilio legal en Chile. Es un requisito obligatorio sin excepciones.</p>
              </div>
            </div>
          </div>

          <!-- Columna derecha: Imagen -->
          <div class="detalle-imagen-column">
            <div class="detalle-imagen-card">
              <h3 class="imagen-title">IMAGEN</h3>
              <p class="imagen-subtitle">Fotograf√≠a del equipo</p>
              <div class="photo-frame">
                <img 
                  *ngIf="dispositivoSeleccionado?.foto && !imageLoadError"
                  [src]="dispositivoSeleccionado.foto" 
                  [alt]="dispositivoSeleccionado.modelo"
                  class="photo-frame-image"
                  (error)="onImageError($event)"
                  (load)="imageLoadError = false">
                <div *ngIf="!dispositivoSeleccionado?.foto || imageLoadError" class="photo-placeholder">
                  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.5 13.5C9.32843 13.5 10 12.8284 10 12C10 11.1716 9.32843 10.5 8.5 10.5C7.67157 10.5 7 11.1716 7 12C7 12.8284 7.67157 13.5 8.5 13.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <p>Sin imagen</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Segunda fila: B. CARACTER√çSTICAS T√âCNICAS (full width) - Visible para ambas resoluciones -->
        <div class="tech-section" *ngIf="authService.isAuthenticated() || hasTechnicalData() || dispositivoSeleccionado.resolutionVersion == 2017 || dispositivoSeleccionado.resolutionVersion === '2017'">
          <div class="info-section-card">
            <h2 class="info-section-title">B. CARACTER√çSTICAS T√âCNICAS</h2>
            <p class="info-section-subtitle">Resoluci√≥n {{ dispositivoSeleccionado.resolutionVersion || '‚Äî' }}</p>
            
            <table class="tech-table">
              <thead>
                <tr>
                  <th class="tech-header-param">PAR√ÅMETRO</th>
                  <th class="tech-header-value">VALOR</th>
                </tr>
              </thead>
              <tbody>
                <!-- Fila: Tipo de Dispositivo - Visible para ambas resoluciones -->
                <tr *ngIf="dispositivoSeleccionado.tipo">
                  <td class="tech-param">Tipo de Dispositivo</td>
                  <td class="tech-value">{{ dispositivoSeleccionado.tipo }}</td>
                </tr>
                
                <!-- Filas espec√≠ficas para Resoluci√≥n 2017 -->
                <ng-container *ngIf="dispositivoSeleccionado.resolutionVersion == 2017 || dispositivoSeleccionado.resolutionVersion === '2017'">
                  <tr>
                    <td class="tech-param">Fecha de Certificaci√≥n SUBTEL</td>
                    <td class="tech-value">{{ getFechaCertificacionSubtel() }}</td>
                  </tr>
                  
                  <tr>
                    <td class="tech-param">Oficio de Certificaci√≥n SUBTEL</td>
                    <td class="tech-value">{{ dispositivoSeleccionado.oficioCertificacionSubtel || '‚Äî' }}</td>
                  </tr>
                </ng-container>
                
                <!-- Filas espec√≠ficas para Resoluci√≥n 2025 - Todas las especificaciones t√©cnicas -->
                <ng-container *ngIf="dispositivoSeleccionado.resolutionVersion == 2025 || dispositivoSeleccionado.resolutionVersion === '2025'">
                  <tr *ngIf="dispositivoSeleccionado.tecnologia && dispositivoSeleccionado.tecnologia.length > 0">
                    <td class="tech-param">Tecnolog√≠a / modulaci√≥n</td>
                    <td class="tech-value">
                      <div class="array-value-list">
                        <div *ngFor="let item of dispositivoSeleccionado.tecnologia" class="array-value-item">{{ item }}</div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr *ngIf="dispositivoSeleccionado.frecuencias && dispositivoSeleccionado.frecuencias.length > 0">
                    <td class="tech-param">Frecuencias</td>
                    <td class="tech-value">
                      <div class="array-value-list">
                        <div *ngFor="let item of dispositivoSeleccionado.frecuencias" class="array-value-item">{{ item }}</div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr *ngIf="dispositivoSeleccionado.gananciaAntena && dispositivoSeleccionado.gananciaAntena.length > 0">
                    <td class="tech-param">Ganancia de antena (dBi)</td>
                    <td class="tech-value">
                      <div class="array-value-list">
                        <div *ngFor="let item of dispositivoSeleccionado.gananciaAntena" class="array-value-item">{{ item }}</div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr *ngIf="dispositivoSeleccionado.EIRP && dispositivoSeleccionado.EIRP.length > 0">
                    <td class="tech-param">P.I.R.E. (EIRP)</td>
                    <td class="tech-value">
                      <div class="array-value-list">
                        <div *ngFor="let item of dispositivoSeleccionado.EIRP" class="array-value-item">{{ item }}</div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr *ngIf="dispositivoSeleccionado.modulo && dispositivoSeleccionado.modulo.length > 0">
                    <td class="tech-param">M√≥dulos</td>
                    <td class="tech-value">
                      <div class="array-value-list">
                        <div *ngFor="let item of dispositivoSeleccionado.modulo" class="array-value-item">{{ item }}</div>
                      </div>
                    </td>
                  </tr>
                  
                  <tr *ngIf="dispositivoSeleccionado.nombreTestReport && dispositivoSeleccionado.nombreTestReport.length > 0">
                    <td class="tech-param">Nombre de Test Report</td>
                    <td class="tech-value">
                      <div class="test-report-list">
                        <div *ngFor="let report of dispositivoSeleccionado.nombreTestReport" class="test-report-item">
                          <a *ngIf="getTestReportUrl(parseTestReport(report).fileName)" 
                             [href]="getTestReportUrl(parseTestReport(report).fileName)" 
                             target="_blank" 
                             class="test-report-link">
                            {{ parseTestReport(report).fileName }}
                          </a>
                          <span *ngIf="!getTestReportUrl(parseTestReport(report).fileName)" class="test-report-text">
                            {{ parseTestReport(report).fileName }}
                          </span>
                          <span *ngIf="parseTestReport(report).pages" class="test-report-pill">
                            {{ parseTestReport(report).pages }}
                          </span>
                        </div>
                      </div>
                    </td>
                  </tr>
                </ng-container>
              </tbody>
            </table>

            <!-- Banner de Test Report debajo de la tabla t√©cnica - Solo visible para Resoluci√≥n 2025 -->
            <div *ngIf="(dispositivoSeleccionado.resolutionVersion == 2025 || dispositivoSeleccionado.resolutionVersion === '2025') && dispositivoSeleccionado.testReportFiles && dispositivoSeleccionado.testReportFiles.trim() !== ''" class="test-report-banner">
              <div class="test-report-banner-left">
                <div class="test-report-banner-icon">
                  <mat-icon>description</mat-icon>
                </div>
                <div class="test-report-banner-texts">
                  <div class="test-report-banner-title">
                    INFORME DE ENSAYO (TEST REPORT)
                  </div>
                  <div class="test-report-banner-subtitle">
                    En una p√°gina real, aqu√≠ se incluir√≠a el PDF descargable del informe de ensayo.
                  </div>
                </div>
              </div>

              <a
                class="test-report-banner-button"
                [href]="dispositivoSeleccionado.testReportFiles"
                target="_blank"
                rel="noopener"
                download
              >
                Descargar Test Report
              </a>
            </div>
          </div>
        </div>

        <!-- Tercera fila: C. DECLARACI√ìN DE CONFORMIDAD (full width) -->
        <div class="conformidad-section">
          <div class="info-section-card">
            <h2 class="info-section-title">C. DECLARACI√ìN DE CONFORMIDAD</h2>
            <p class="info-section-subtitle">Texto requerido</p>
            
            <div class="conformidad-quote">
              <p>El equipo previamente individualizado cumple con las disposiciones establecidas en la Norma T√©cnica de Equipos de alcance reducido, aprobada por la resoluci√≥n exenta N¬∞ 1.985, de 2017, de la Subsecretar√≠a de Telecomunicaciones.</p>
            </div>
            
            <p class="conformidad-note">
              Este texto se presenta como declaraci√≥n requerida por el proceso de alcance reducido. La documentaci√≥n de respaldo se mantiene disponible para requerimientos.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer>
      <div class="container">
        <div class="footer-grid">
          <div>
            <div style="display:flex; gap:10px; align-items:center; margin-bottom: 8px;">
              <div class="footer-logo-wrapper">
                <img class="brand-logo-img footer-logo" src="assets/lb-technology-logo.png" alt="LB Technology" />
              </div>
              <div style="font-weight: 750;">Alcance Reducido ¬∑ Operado por LB Technology</div>
            </div>
            <div>
              ¬© {{ currentYear }} LB Technology. Todos los derechos reservados.
              <div style="margin-top:6px;">
                <span style="color: var(--muted2);">
                  Aviso: contenido informativo de alto nivel. La implementaci√≥n final depende del caso y documentaci√≥n del equipo.
                </span>
              </div>
            </div>
          </div>

          <div class="foot-links">
            <a (click)="goToHome()" style="cursor: pointer;">Home</a>
            <a (click)="goToHome()" style="cursor: pointer;">Normativa</a>
            <a (click)="goToHome()" style="cursor: pointer;">Servicios</a>
            <a (click)="goToHome()" style="cursor: pointer;">Contacto</a>
          </div>
        </div>
      </div>
    </footer>
  </div>
</div>
